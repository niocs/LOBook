<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Part4 Simple component | Libreoffice Blog</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="../extensions/part5.html" />
    
    
    <link rel="prev" href="../extensions/part3.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
    

        
    <div class="book" data-level="4.5" data-basepath=".." data-revision="Thu Nov 03 2016 21:15:50 GMT+0530 (IST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="patches/index.html">
            
                
                    <a href="../patches/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        patches
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="patches/rsu.html">
            
                
                    <a href="../patches/rsu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Red squiggly underline bug
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="calcarch/index.html">
            
                
                    <a href="../calcarch/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Calc architecture
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="calcarch/overview.html">
            
                
                    <a href="../calcarch/overview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        overview
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="calcarch/core.html">
            
                
                    <a href="../calcarch/core.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        core
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="calcarch/ui.html">
            
                
                    <a href="../calcarch/ui.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        ui
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="calcarch/filter.html">
            
                
                    <a href="../calcarch/filter.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        filter
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="misc/index.html">
            
                
                    <a href="../misc/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Libreoffice misc
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="misc/devsetup.html">
            
                
                    <a href="../misc/devsetup.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        devsetup
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="misc/sdksetup.html">
            
                
                    <a href="../misc/sdksetup.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        sdksetup
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="misc/devserver.html">
            
                
                    <a href="../misc/devserver.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        devserver
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="misc/bibisect.html">
            
                
                    <a href="../misc/bibisect.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        bibisect
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="misc/mdds.html">
            
                
                    <a href="../misc/mdds.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        mdds
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="misc/namespaces.html">
            
                
                    <a href="../misc/namespaces.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        namespaces
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="misc/patchchecklist.html">
            
                
                    <a href="../misc/patchchecklist.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        patchchecklist
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="extensions/index.html">
            
                
                    <a href="../extensions/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        LibreOffice extensions
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="extensions/prefaq.html">
            
                
                    <a href="../extensions/prefaq.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        PreFAQ
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="extensions/part1.html">
            
                
                    <a href="../extensions/part1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Part1 UNO Intro
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="extensions/part2.html">
            
                
                    <a href="../extensions/part2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        Part2 Remote Calc
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="extensions/part3.html">
            
                
                    <a href="../extensions/part3.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        Part3 UNO communication
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="4.5" data-path="extensions/part4.html">
            
                
                    <a href="../extensions/part4.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        Part4 Simple component
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="extensions/part5.html">
            
                
                    <a href="../extensions/part5.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        Part5 Addon
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="extensions/part6.html">
            
                
                    <a href="../extensions/part6.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        Part6 ProtocolHandler extension
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="extensions/part7.html">
            
                
                    <a href="../extensions/part7.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.</b>
                        
                        Part7 AsyncJob extension
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="extensions/part8.html">
            
                
                    <a href="../extensions/part8.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.</b>
                        
                        Part8 SingletonComponent
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Libreoffice Blog</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="libreoffice-extension-development-with-c-part-4-build-a-simple-component-with-two-services">Libreoffice extension development with C++ - Part 4 - Build a simple Component with two services.</h1>
<h3 id="audience-selection">Audience selection</h3>
<ol>
<li>Audience type <strong><a href="index.html">AUD-C</a></strong> can jump directly to <strong><a href="#prebuilt">Test the prebuilt extension</a></strong></li>
<li>Audience type <strong><a href="index.html">AUD-B</a></strong> can jump directly to <strong><a href="#buildsec">Download, build and test the extension</a></strong></li>
</ol>
<hr>
<p>Note that reading previous posts are a prerequisite for following this part unless you know how to setup LO SDK env and have a good understanding of UNO concepts.</p>
<h2 id="what-we-are-about-to-do">What we are about to do ?</h2>
<ol>
<li><p>Create an .idl file with</p>
<ol>
<li>a simple interface XSomething that has two methods.</li>
<li>two services MyService1 and MyService2 which supports XSomething interface.</li>
</ol>
</li>
<li><p>Write an implementation for the two services in the files service1_impl.cxx and service2_impl.cxx.</p>
</li>
<li><p>Write service operations for the services in service1_impl.cxx and service2_impl.cxx.</p>
</li>
<li><p>Write component operations in service2_impl.cxx.</p>
</li>
<li><p>Use UNO SDK tools to create C++ header files from .idl files (ours and the dependent LO buildin .idl files).</p>
</li>
<li><p>Build the component &quot;SimpleComponent&quot; from service implementation cxx files with the hdl files generated in step 5,
and package it into an extension file named as &quot;SimpleComponent.oxt&quot;.</p>
</li>
<li><p>Install our extension in LO.</p>
</li>
<li><p>Create an ods file with embedded macro to test the two services in our extension.</p>
</li>
<li><p>Use a C++ main program that accesses remote LO process to test the two services in our extension.</p>
</li>
</ol>
<p>Let&apos;s now go into these 9 steps in detail.</p>
<h2 id="step-1">Step 1</h2>
<p>Lets define an interface called <code>XSomething</code> that has two methods -</p>
<ul>
<li><code>methodOne()</code> that accepts a string and returns a string.</li>
<li><code>methodTwo()</code> that has no parameters and returns a string.</li>
</ul>
<pre><code>interface XSomething
{
    string methodOne( [in] string val );
    string methodTwo();
};
</code></pre><p>Next we define a service called <code>MyService1</code> that supports the interface <code>XSomething</code>.
This is just a one liner.</p>
<pre><code>service MyService1 : XSomething;
</code></pre><p>We now define second service called <code>MyService2</code> that again supports the interface <code>XSomething</code>.
All services come with an implicit object creator function called <code>create()</code> that <strong>implicitly</strong> accepts the component context object , but we want <code>MyService2</code>&apos;s <code>create()</code> function to accept a string parameter <em>in addition</em>. We also want this function to throw an <code>IllegalArgumentException</code> if the user did not give the string argument. We would code that logic while implementation the service, but we need to specify the exception it may throw if any. One exception is <code>RuntimeException</code> which can be thrown by any methods without explicitly specifying it.</p>
<pre><code>service MyService2 : XSomething
{
    create([in]string sArgument)
         raises (::com::sun::star::lang::IllegalArgumentException);
};
</code></pre><p>We next need to scope all these definitions under a heirarchy of modules. Lets scope the definitions under the module scope <code>inco::niocs::test</code> as an example.</p>
<pre><code>module inco { module niocs { module test {

// Put the interface and service definitions here.

}; }; };
</code></pre><p>Since all interfaces implicitly derive from the interface <code>XInterface</code> we need to include its corresponding idl file. Also since we need to use the exception <code>IllegalArgumentException</code>, we need to include its idl file as well.</p>
<pre><code class="lang-cpp"><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;com/sun/star/uno/XInterface.idl&gt;</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;com/sun/star/lang/IllegalArgumentException.idl&gt;</span>
</code></pre>
<p>Like in C++ header files we can avoid namespace conflicts while sourcing header files. This is done be putting the whole content inside the following :</p>
<pre><code class="lang-cpp"><span class="hljs-preprocessor">#ifndef __inco_niocs_test_some_idl__</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> __inco_niocs_test_some_idl__</span>

<span class="hljs-comment">//  The idl file contents goes here.</span>


<span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<h2 id="step-2">Step 2</h2>
<p>Although in the service definition in some.idl file our services only support <code>XSomething</code> interface explicitly, <code>XSomething</code> derives from <code>XInterface</code> interface implicitly we need to implement its methods too.
As a exercise have a look at <code>XInterface</code> idl file from api.libreoffice.org to refresh your memory.</p>
<p>Any service <strong>needs to</strong> implement the following Interfaces. We don&apos;t need to specify these interfaces in the service definition idl file though.</p>
<ul>
<li><code>XInterface</code></li>
<li><code>XTypeProvider</code> - This interface is used by scripting languages such as OpenOffice.org Basic to get type information. OpenOffice.org Basic cannot use the component without it</li>
<li><code>XServiceInfo</code> - This interface lets other objects get information about which all services an implementation supports.</li>
<li><code>XWeak</code> - This interface lets anyone to keep a <strong>weak</strong> reference to your object. The difference between a weak reference and a normal reference is that former lets anyone to access your object without changing its <em>reference count</em>. As a result a weak reference cannot prevent the destruction of the object unless someone else keeps atleast one hard reference to it. XWeak interface also lets the user to retrieve a hard reference.</li>
</ul>
<p>There exists helper classes for easy implementation of <code>XInterface</code>, <code>XTypeProvider</code>, <code>XWeak</code> interfaces. <code>XServiceInfo</code> interface implementation needs to be implemented manually without helper classes.</p>
<p>Following are the interfaces a service may optionally implement. Infact a service may implement any of the LO&apos;s pre-defined interfaces, but these just happens to be the most commonly implemented ones as they are very useful.</p>
<ul>
<li><code>XComponent</code> - This interface is used if there is possibility of occurance of cyclic references. It helps in resolving the cyclic references.</li>
<li><code>XInitialization</code> - This interface lets anyone to use <code>createInstanceWithArguments()</code> and <code>createInstanceWithArgumentsAndContext()</code> with your object. This lets users to pass in any number of arguments while creating our object.</li>
</ul>
<p>There exist a helper class for <code>XComponent</code> interface.</p>
<p>Now we are ready to implement the two services we defined in step 1.</p>
<p>The implementation of <code>MyService1</code> is written in service1_impl.cxx. In this file we declare and define the class <code>MyService1Impl</code> which implements the service <code>MyService1</code>.
The SDK helps us by giving helpers for easy implementation of services. We could however implement without using them always, but here we choose to make use of them to keep things simple.
It provides the template classes <code>cppu::WeakImplHelper2</code>, <code>cppu::WeakImplHelper3</code>, <code>cppu::WeakImplHelper4</code> ... <code>cppu::WeakImplHelper13</code> that acts as base class for our implementations that by automatically implements the interfaces <code>XInterface</code>, <code>XTypeProvider</code>, <code>XWeak</code>. So we do not need to implement them on our own.</p>
<p>In our case <code>MyService1Impl</code>, the implementation class of the service <code>MyService1</code> will just need to derive from the class <code>::cppu::WeakImplHelper2&lt; ::inco::niocs::test::XSomething, lang::XServiceInfo &gt;</code>.
The number 2 in <code>::cppu::WeakImplHelper2</code> stands for the number of interfaces we need to implement <strong>ourselves</strong>. Here we need to implement two interfaces ourselves which are <code>XSomething</code> and <code>XServiceInfo</code>.</p>
<p>Our <code>MyService1Impl</code> class declaration would look like :</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> MyService1Impl : <span class="hljs-keyword">public</span> ::cppu::WeakImplHelper2&lt; ::inco::niocs::test::XSomething, 
                                                       lang::XServiceInfo &gt; 
{

<span class="hljs-keyword">public</span>:

    <span class="hljs-comment">// no need to implement XInterface, XTypeProvider, XWeak</span>

    <span class="hljs-comment">// XServiceInfo methods</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> OUString SAL_CALL <span class="hljs-title">getImplementationName</span><span class="hljs-params">()</span> <span class="hljs-title">throw</span><span class="hljs-params">( RuntimeException )</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> sal_Bool SAL_CALL <span class="hljs-title">supportsService</span><span class="hljs-params">( OUString <span class="hljs-keyword">const</span> &amp; serviceName )</span> <span class="hljs-title">throw</span> <span class="hljs-params">(RuntimeException)</span></span>;
    <span class="hljs-keyword">virtual</span> Sequence&lt; OUString &gt;  <span class="hljs-function">SAL_CALL <span class="hljs-title">getSupportedServiceNames</span><span class="hljs-params">()</span> <span class="hljs-title">throw</span> <span class="hljs-params">(RuntimeException)</span></span>;

    <span class="hljs-comment">// XSomething methods</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> OUString SAL_CALL <span class="hljs-title">methodOne</span><span class="hljs-params">( OUString <span class="hljs-keyword">const</span> &amp; str )</span> <span class="hljs-title">throw</span> <span class="hljs-params">(RuntimeException)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> OUString SAL_CALL <span class="hljs-title">methodTwo</span><span class="hljs-params">()</span> <span class="hljs-title">throw</span> <span class="hljs-params">(RuntimeException)</span></span>;

};
</code></pre>
<p>Note that <code>SAL_CALL</code> macro is not really required for building extensions in Linux. In Windows/Mingw, this expands to <code>__cdecl</code>. See <a href="http://opengrok.libreoffice.org/xref/core/include/sal/types.h#255" target="_blank">http://opengrok.libreoffice.org/xref/core/include/sal/types.h#255</a></p>
<p>Now lets implement the <code>XServiceInfo</code>&apos;s three methods for <code>MyService1Impl</code> class.</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// XServiceInfo implementation</span>
OUString MyService1Impl::getImplementationName()
    <span class="hljs-keyword">throw</span> (RuntimeException)
{
    <span class="hljs-comment">// a unique implementation name</span>
    <span class="hljs-keyword">return</span> OUString(<span class="hljs-string">&quot;inco.niocs.test.my_sc_impl.MyService1&quot;</span>);
}

sal_Bool MyService1Impl::supportsService( OUString <span class="hljs-keyword">const</span> &amp; serviceName )
    <span class="hljs-keyword">throw</span> (RuntimeException)
{
    <span class="hljs-comment">// We just use the following helper function to do the job</span>
    <span class="hljs-keyword">return</span> cppu::supportsService(<span class="hljs-keyword">this</span>, serviceName);
}

Sequence&lt; OUString &gt; MyService1Impl::getSupportedServiceNames()
    <span class="hljs-keyword">throw</span> (RuntimeException)
{
    Sequence&lt;OUString&gt; names(<span class="hljs-number">1</span>);
    names[<span class="hljs-number">0</span>] = OUString(<span class="hljs-string">&quot;inco.niocs.test.MyService1&quot;</span>);
    <span class="hljs-keyword">return</span> names;
}
</code></pre>
<p>Finally we implement <code>XSomething</code>, the interface we actually care about, though it does not do much here.</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// XSomething implementation</span>
OUString MyService1Impl::methodOne( OUString <span class="hljs-keyword">const</span> &amp; str )
    <span class="hljs-keyword">throw</span> (RuntimeException)
{
    <span class="hljs-keyword">return</span> OUString(<span class="hljs-string">&quot;called methodOne() of MyService1 implementation: &quot;</span>) + str;
}

OUString MyService1Impl::methodTwo()
    <span class="hljs-keyword">throw</span> (RuntimeException)
{
    <span class="hljs-keyword">return</span> OUString(<span class="hljs-string">&quot;called methodTwo() of MyService1 implementation: &quot;</span>);
}
</code></pre>
<p>Next we write the class <code>MyService2Impl</code> which implements the service <code>MyService2</code>. Remember that we need to accept one string parameter for the service object creation function. We do this via <code>XInitialization</code> interface. We also store the accepted string argument as a private data member called <code>m_sArg</code> in the class <code>MyService2Impl</code>. The constructor of <code>MyService2Impl</code> accepts the component context object and stores in a private data member <code>m_xContext</code>. In our simple example this is not actually required, but in non-trivial applications the service may need the component context object for accessing other objects in may need.</p>
<p>The class declaration of <code>MyService2Impl</code> would now look like :</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> MyService2Impl : <span class="hljs-keyword">public</span> ::cppu::WeakImplHelper3&lt; ::inco::niocs::test::XSomething, 
                                                       lang::XServiceInfo,
                                                       lang::XInitialization &gt; 
{
    OUString m_sArg;
    Reference&lt;XComponentContext&gt; m_xContext;

<span class="hljs-keyword">public</span>:

    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-title">MyService2Impl</span><span class="hljs-params">(Reference&lt; XComponentContext &gt; <span class="hljs-keyword">const</span> &amp; xContext)</span> <span class="hljs-title">throw</span> <span class="hljs-params">()</span>
            : <span class="hljs-title">m_xContext</span><span class="hljs-params">(xContext)</span>
    </span>{}
    <span class="hljs-keyword">virtual</span> ~MyService2Impl() {}

    <span class="hljs-comment">// no need to implement XInterface, XTypeProvider, XWeak</span>

    <span class="hljs-comment">// XServiceInfo methods</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> OUString SAL_CALL <span class="hljs-title">getImplementationName</span><span class="hljs-params">()</span> <span class="hljs-title">throw</span><span class="hljs-params">( RuntimeException )</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> sal_Bool SAL_CALL <span class="hljs-title">supportsService</span><span class="hljs-params">( OUString <span class="hljs-keyword">const</span> &amp; serviceName )</span> <span class="hljs-title">throw</span> <span class="hljs-params">(RuntimeException)</span></span>;
    <span class="hljs-keyword">virtual</span> Sequence&lt; OUString &gt;  <span class="hljs-function">SAL_CALL <span class="hljs-title">getSupportedServiceNames</span><span class="hljs-params">()</span> <span class="hljs-title">throw</span> <span class="hljs-params">(RuntimeException)</span></span>;

    <span class="hljs-comment">// XSomething methods</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> OUString SAL_CALL <span class="hljs-title">methodOne</span><span class="hljs-params">( OUString <span class="hljs-keyword">const</span> &amp; str )</span> <span class="hljs-title">throw</span> <span class="hljs-params">(RuntimeException)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> OUString SAL_CALL <span class="hljs-title">methodTwo</span><span class="hljs-params">()</span> <span class="hljs-title">throw</span> <span class="hljs-params">(RuntimeException)</span></span>;

    <span class="hljs-comment">// XInitialization methods</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> SAL_CALL <span class="hljs-title">initialize</span><span class="hljs-params">( Sequence&lt; Any &gt; <span class="hljs-keyword">const</span> &amp; args )</span> <span class="hljs-title">throw</span> <span class="hljs-params">(Exception)</span></span>;

};
</code></pre>
<p>Now lets implement the <code>XServiceInfo</code>&apos;s three methods for <code>MyService2Impl</code> class.</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// XServiceInfo implementation</span>
OUString MyService2Impl::getImplementationName()
    <span class="hljs-keyword">throw</span> (RuntimeException)
{
    <span class="hljs-comment">// a unique implementation name</span>
    <span class="hljs-keyword">return</span> OUString(<span class="hljs-string">&quot;inco.niocs.test.my_sc_impl.MyService2&quot;</span>);
}

sal_Bool MyService2Impl::supportsService( OUString <span class="hljs-keyword">const</span> &amp; serviceName )
    <span class="hljs-keyword">throw</span> (RuntimeException)
{
    <span class="hljs-comment">// We just use the following helper function to do the job</span>
    <span class="hljs-keyword">return</span> cppu::supportsService(<span class="hljs-keyword">this</span>, serviceName);
}

Sequence&lt; OUString &gt; MyService2Impl::getSupportedServiceNames()
    <span class="hljs-keyword">throw</span> (RuntimeException)
{
    Sequence&lt;OUString&gt; names(<span class="hljs-number">1</span>);
    names[<span class="hljs-number">0</span>] = OUString(<span class="hljs-string">&quot;inco.niocs.test.MyService2&quot;</span>);
    <span class="hljs-keyword">return</span> names;
}
</code></pre>
<p>Finally we implement <code>XSomething</code>, the interface we actually care about.</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// XSomething implementation</span>
OUString MyService2Impl::methodOne( OUString <span class="hljs-keyword">const</span> &amp; str )
    <span class="hljs-keyword">throw</span> (RuntimeException)
{
    <span class="hljs-keyword">return</span> OUString(<span class="hljs-string">&quot;called methodOne() of MyService2 implementation: &quot;</span>) + str;
}

OUString MyService2Impl::methodTwo()
    <span class="hljs-keyword">throw</span> (RuntimeException)
{
    <span class="hljs-keyword">return</span> OUString(<span class="hljs-string">&quot;called methodTwo() of MyService2 implementation: &quot;</span>);
}
</code></pre>
<p>We also need to implement <code>initialize</code> - the sole method of <code>XInitialization</code> interface.
In our case we accept only a single string argument else we throw an <code>IllegalArgumentException</code> exception.
The accepted string argument is stored in the <code>m_sArg</code> data member of <code>MyService2Impl</code>.</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// XInitialization implementation</span>
<span class="hljs-keyword">void</span> MyService2Impl::initialize( Sequence&lt; Any &gt; <span class="hljs-keyword">const</span> &amp; args )
    <span class="hljs-keyword">throw</span> (Exception)
{
    <span class="hljs-keyword">if</span> (args.getLength() != <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">throw</span> lang::IllegalArgumentException(
              OUString(<span class="hljs-string">&quot;give a string instanciating this component!&quot;</span>),
              <span class="hljs-keyword">static_cast</span>&lt; ::cppu::OWeakObject * &gt;(<span class="hljs-keyword">this</span>),
              <span class="hljs-number">0</span> ); <span class="hljs-comment">// argument pos</span>
    }

    <span class="hljs-keyword">if</span> (! (args[ <span class="hljs-number">0</span> ] &gt;&gt;= m_sArg)) {
        <span class="hljs-keyword">throw</span> lang::IllegalArgumentException(
              OUString(<span class="hljs-string">&quot;no string given as argument!&quot;</span>),
              <span class="hljs-keyword">static_cast</span>&lt; ::cppu::OWeakObject * &gt;(<span class="hljs-keyword">this</span>),
              <span class="hljs-number">0</span> ); <span class="hljs-comment">// argument pos</span>
    }
}
</code></pre>
<h2 id="step-3">Step 3</h2>
<p>We now need to write service operation functions for both the services. These are not exported functions but we will use them in writing component operations functions we define in Step 4.</p>
<p>Following are the service operation functions we define in service1_impl.cxx file.</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// service operations for MyService1Impl</span>
Sequence&lt; OUString &gt; getSupportedServiceNames_MyService1Impl()
{
    Sequence&lt;OUString&gt; names(<span class="hljs-number">1</span>);
    names[<span class="hljs-number">0</span>] = OUString(<span class="hljs-string">&quot;inco.niocs.test.MyService1&quot;</span>);
    <span class="hljs-keyword">return</span> names;
}

<span class="hljs-function">OUString <span class="hljs-title">getImplementationName_MyService1Impl</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> OUString(<span class="hljs-string">&quot;inco.niocs.test.my_sc_impl.MyService1&quot;</span>);
}

<span class="hljs-comment">// Service object contructor function.</span>
Reference&lt; XInterface &gt; <span class="hljs-function">SAL_CALL <span class="hljs-title">create_MyService1Impl</span><span class="hljs-params">( Reference&lt; XComponentContext &gt; <span class="hljs-keyword">const</span> &amp; xContext )</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">static_cast</span>&lt; lang::XTypeProvider * &gt;( <span class="hljs-keyword">new</span> MyService1Impl() );
}
</code></pre>
<p>and we define the following service operations in service2_impl.cxx file.</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// service operations for MyService2Impl</span>
Sequence&lt; OUString &gt; getSupportedServiceNames_MyService2Impl()
{
    Sequence&lt;OUString&gt; names(<span class="hljs-number">1</span>);
    names[<span class="hljs-number">0</span>] = OUString(<span class="hljs-string">&quot;inco.niocs.test.MyService2&quot;</span>);
    <span class="hljs-keyword">return</span> names;
}

<span class="hljs-function">OUString <span class="hljs-title">getImplementationName_MyService2Impl</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> OUString(<span class="hljs-string">&quot;inco.niocs.test.my_sc_impl.MyService2&quot;</span>);
}

<span class="hljs-comment">// Service object contructor function.</span>
Reference&lt; XInterface &gt; <span class="hljs-function">SAL_CALL <span class="hljs-title">create_MyService2Impl</span><span class="hljs-params">( Reference&lt; XComponentContext &gt; <span class="hljs-keyword">const</span> &amp; xContext )</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">static_cast</span>&lt; lang::XTypeProvider * &gt;( <span class="hljs-keyword">new</span> MyService2Impl( xContext ) );
}
</code></pre>
<h2 id="step-4">Step 4</h2>
<p>NOTE: The code we write in this step is boilerplate and is not explained in detail because we can afford to skim through this. We need to do this for every component we write and is quite copy/pastable.</p>
<p>We choose to write <strong>component operation</strong> functions in service2_impl.cxx. The Component operation functions register the component along with its service implementations with LO so that our implementations are discoverable and can be used in LO.</p>
<p>These functions are exported functions with defined with the macro <code>SAL_DLLPUBLIC_EXPORT</code> within <code>extern &quot;C&quot; block</code> so that g++ compiler does not mangle/change these exported names.</p>
<p>Before we define these functions, we create an unexported array of <code>::cppu::ImplementationEntry</code>&apos;s of which each element corresponds to the particulars of a service.</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// This struct makes it easy to implement the extern &quot;C&quot; exported component operations</span>
<span class="hljs-comment">// using helper functions.</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">struct</span> ::cppu::ImplementationEntry s_component_entries [] =  {
    {   <span class="hljs-comment">// Service1</span>
        create_MyService1Impl, getImplementationName_MyService1Impl,
        getSupportedServiceNames_MyService1Impl, ::cppu::createSingleComponentFactory,
        <span class="hljs-number">0</span>, <span class="hljs-number">0</span>  <span class="hljs-comment">// last two entries reserved for future use, can be zeros.</span>
    },
    {
        <span class="hljs-comment">// Service2</span>
        create_MyService2Impl, getImplementationName_MyService2Impl,
        getSupportedServiceNames_MyService2Impl, ::cppu::createSingleComponentFactory,
        <span class="hljs-number">0</span>, <span class="hljs-number">0</span>
    },

    <span class="hljs-comment">// NULL termination.</span>
    { <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> }
};
</code></pre>
<p>In the component operation function <code>component_getFactory()</code> we make use of the helper function <code>::cppu::component_getFactoryHelper()</code> and the array we created above.</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// Exported component operations</span>

<span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> <span class="hljs-comment">// To skip g++&apos;s function name decorations</span>
{

    SAL_DLLPUBLIC_EXPORT <span class="hljs-keyword">void</span> * <span class="hljs-function">SAL_CALL <span class="hljs-title">component_getFactory</span><span class="hljs-params">(
                              sal_Char <span class="hljs-keyword">const</span> * implName, lang::XMultiServiceFactory * xMgr,
                              registry::XRegistryKey * xRegistry )</span>
    </span>{
        <span class="hljs-keyword">return</span> ::cppu::component_getFactoryHelper(
               implName, xMgr, xRegistry, ::my_sc_impl::s_component_entries );
    }

    <span class="hljs-function">SAL_DLLPUBLIC_EXPORT <span class="hljs-keyword">void</span> SAL_CALL <span class="hljs-title">component_getImplementationEnvironment</span><span class="hljs-params">(
                              <span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> ** ppEnvTypeName, uno_Environment **)</span>
    </span>{
        *ppEnvTypeName = CPPU_CURRENT_LANGUAGE_BINDING_NAME;
    }

}
</code></pre>
<hr>
<h2 id="-a-name-buildsec-a-download-build-and-test-the-extension"><a name="buildsec"></a>Download, build and test the extension</h2>
<h3 id="steps-5-and-6">Steps 5 and 6</h3>
<p>In this section we use UNO SDK tools to create C++ header files from .idl files (ours and the dependent LO buildin .idl files) and build the component &quot;SimpleComponent&quot; from service implementation cxx files with the hdl files generated and package it into an extension file named as &quot;SimpleComponent.oxt&quot;. Doing these operations manually is tedious hence we have a Makefile reused from the LO SDK&apos;s sample extensions.</p>
<p>The whole project can be downloaded and built using the following steps.</p>
<pre><code>$ git clone https://github.com/niocs/SimpleUNOComponent.git
$ cd SimpleUNOComponent
$ make
</code></pre><p>The extension created (<code>SimpleComponent.oxt</code>) by the above will go to a path that looks like <code>/home/dennis/libreoffice5.3_sdk/LINUXexample.out/bin/</code> unless you used a non default path while setting up SDK env.
You can also see the generated include files from idl files in <code>/home/dennis/libreoffice5.3_sdk/LINUXexample.out/inc/</code>.</p>
<h3 id="step-7">Step 7</h3>
<p>Now we need to install the extension file <code>SimpleComponent.oxt</code> at <code>/home/$username/libreoffice5.3_sdk/LINUXexample.out/bin/</code> to LO.
There are two ways to do this : one via the extension manager and other via <code>unopkg</code> commandline tool. Do only one of the following substeps :</p>
<ul>
<li>Extension-Manager method : Open Calc and and go to Tools &gt; Extension Manager &gt; Click add button, browse and select <code>SimpleComponent.oxt</code> and click on &quot;Only for me&quot; button for the dialog &quot;For whom do you want to install the extension ?&quot;. You may need to restart Calc to take effect.</li>
<li>CommandLine method : just run the below command in terminal as normal user.<pre><code>$ $LOROOT/instdir/program/unopkg add &lt;/path/to/&gt;SimpleComponent.oxt
</code></pre>You can remove an extension with its name (without path) via unopkg, for example to remove SimpleComponent.oxt  :<pre><code>$ $LOROOT/instdir/program/unopkg remove SimpleComponent.oxt
</code></pre></li>
</ul>
<h3 id="step-8">Step 8</h3>
<p>Lets now test if the extension is working. One way is we can instantiate the services we implemented, via LibreOffice Basic macros. For this we need to enable macros in Calc.
Go to Tools &gt; Options &gt; Security &gt; Click &quot;Macro Security&quot; &gt; Select the radio button &quot;Medium - Confirmation required before executing macros from untrusted source&quot;. Restart Calc now.</p>
<p>You could either follow the below instruction to setup macro and controls to execute it or just open the <code>SimpleComponent.ods</code> provided in the git repo. While opening click enable macros when asked. Now click on the button &quot;Click to test our extension&quot;. On clicking if everything went well, it should show the messages from the <code>MyService1</code>&apos;s <code>methodOne()</code> and <code>MyService2</code>&apos;s <code>methodTwo()</code>.</p>
<h4 id="creating-an-ods-file-with-macro-to-access-our-extension">Creating an ods file with macro to access our extension.</h4>
<p>Save the sheet as SimpleComponent.ods . Go to Tools &gt; Macros &gt; Organize Macros &gt; LibreofficeDev Basic &gt; Select &quot;Standard&quot; module inside &quot;SimpleComponent.ods&quot; on the left section &gt; Click &quot;New&quot; button on the right section. Now it will open a Macro editor. Now insert the following Basic funtion named <code>TestMyExtension</code> to instantiate and call the methods on the two services.</p>
<pre><code class="lang-vbscript"><span class="hljs-keyword">Sub</span> TestMyExtension
    <span class="hljs-keyword">Dim</span> oService1Inst
    <span class="hljs-keyword">Dim</span> oService2Inst
    <span class="hljs-keyword">On</span> <span class="hljs-keyword">Error</span> <span class="hljs-keyword">Goto</span> ErrorHandler

    oService1Inst = inco.niocs.test.MyService1.create()
    oService2Inst = inco.niocs.test.MyService2.create( <span class="hljs-string">&quot;:SERVICE2:&quot;</span> )
    <span class="hljs-keyword">If</span> <span class="hljs-built_in">IsNull</span>( oService1Inst ) <span class="hljs-keyword">Or</span> <span class="hljs-built_in">IsNull</span>( oService2Inst ) <span class="hljs-keyword">Then</span>
        <span class="hljs-built_in">msgbox</span> <span class="hljs-string">&quot;Could not instantiate one or more of our services in the extension.&quot;</span>
    <span class="hljs-keyword">Else</span>
    <span class="hljs-built_in">msgbox</span> oService1Inst.methodOne(<span class="hljs-string">&quot;:SERVICE1:&quot;</span>) &amp; <span class="hljs-string">&quot;. and &quot;</span> &amp; oService2Inst.methodTwo()
    <span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span>
    <span class="hljs-keyword">Exit</span> <span class="hljs-keyword">Sub</span>
    ErrorHandler:
    <span class="hljs-built_in">msgbox</span> <span class="hljs-string">&quot;SimpleComponent Extension not installed properly&quot;</span>
<span class="hljs-keyword">End</span> <span class="hljs-keyword">Sub</span>
</code></pre>
<p>Lets now create a push button control. Go to View &gt; Toolbars &gt; Form Controls &gt; Click on Design Mode in the new toolbar &gt; Click on pushbutton control and draw in an empty sheet. Right click on the Push button and click &quot;Control...&quot; and change Label to &quot;Click to test our extension&quot;. Go to Events tab and set Execution action &gt; Assign Macro &gt; Browse and select <code>TestMyExtension</code> macro we created above.</p>
<h3 id="step-9">Step 9</h3>
<p>One other method to test if our extension is working is to create a standalone test C++ main program like we did in <a href="part1.html">Part 1</a> and <a href="part2.html">Part 2</a> of this article.
The complete test program <code>TestSimpleComponent.cxx</code> is provided in the git repo. So you could test the extension by issuing</p>
<pre><code>$ make TestSimpleComponent.run
</code></pre><hr>
<h2 id="-a-name-prebuilt-a-test-the-prebuilt-extension"><a name="prebuilt"></a>Test the prebuilt extension</h2>
<p>Download the extension as :</p>
<pre><code>$ git clone https://github.com/niocs/SimpleUNOComponent.git
$ cd SimpleUNOComponent
</code></pre><ul>
<li>In <code>SimpleUNOComponent</code> directory you will see a file called <code>SimpleComponent.oxt</code>. This is the prebuilt extension.</li>
<li>There are two recommended ways of installing extensions - one via the extension manager and other via <code>unopkg</code> commandline tool. Do only one of the following substeps :<ul>
<li>Extension-Manager method : Open Calc and and go to Tools &gt; Extension Manager &gt; Click add button, browse and select <code>SimpleComponent.oxt</code> and click on &quot;Only for me&quot; button for the dialog &quot;For whom do you want to install the extension ?&quot;. You may need to restart Calc to take effect.</li>
<li>CommandLine method : just run the below command in terminal as normal user.<pre><code>$ unopkg add &lt;/path/to/&gt;SimpleComponent.oxt
</code></pre>You can remove an extension with its name (without path) via unopkg, for example to remove SimpleComponent.oxt  :<pre><code>$ unopkg remove SimpleComponent.oxt
</code></pre></li>
</ul>
</li>
<li>Now we need to allow macros in Calc if you have not already. Open Calc and go to Tools &gt; Options &gt; Security &gt; Click &quot;Macro Security&quot; &gt; Select the radio button &quot;Medium - Confirmation required before executing macros from untrusted source&quot;. Restart Calc. This is a one time process.</li>
<li>In the <code>SimpleUNOComponent/</code> directory there is a file called <code>SimpleComponent.ods</code>. This is a spreadsheet file with macros embedded to test the extension. Open this file with calc. While opening click enable macros when asked.</li>
<li><p>Now click on the button &quot;Click to test our extension&quot; inside the sheet. On clicking, if everything went well, it should show a messagebox showing the text</p>
<p><code>called methodOne() of Service1 implementation : :SERVICE1:. and called methodTwo() of MyService2 implementation: :SERVICE2:</code>.</p>
</li>
</ul>
<hr>
<h2 id="-advanced-commands-for-building-the-extension-without-using-makefile">[Advanced] Commands for building the extension without using Makefile</h2>
<ol>
<li><p>First we create the directory <code>/home/$username/extensions/</code> and its sub directory <code>misc/SimpleComponent/</code> to store the .urd file(s) (UNO reflection data) containing binary type descriptions.</p>
<pre><code>$ mkdir -p /home/$username/extensions/misc/SimpleComponent
$ $LOROOT/instdir/sdk/bin/idlc -I. -I$LOROOT/instdir/sdk/idl -O/home/$username/extensions/misc/SimpleComponent some.idl
</code></pre><p>This creates the file <code>/home/$username/extensions/misc/SimpleComponent/some.urd</code></p>
</li>
<li><p>Merge the .urd files into a registry database using regmerge. The registry database files have the extension .rdb (registry database). They contain binary data describing types in a tree-like structure starting with / as the root. The default key for type descriptions is the /UCR key (UNO core reflection).</p>
<pre><code>$ $LOROOT/instdir/program/regmerge \
    /home/$username/extensions/misc/SimpleComponent/SimpleComponent.uno.rdb \
    /UCR /home/$username/extensions/misc/SimpleComponent/some.urd
</code></pre><p>This will produce the file <code>/home/$username/extensions/misc/SimpleComponent/SimpleComponent.uno.rdb</code>.</p>
</li>
<li><p>This is a <strong>one time step</strong>, generate C++ header files for all of sdk&apos;s uno types from the LO&apos;s rdb files and put into <code>/home/$username/extensions/inc</code>, the common include location used for all of our future extensions including current one.</p>
<pre><code>$ mkdir -p /home/$username/extensions/inc
$ $LOROOT/instdir/sdk/bin/cppumaker -Gc -O/home/$username/extensions/inc  \
                                    $LOROOT/instdir/program/types.rdb \
                                    $LOROOT/instdir/program/types/offapi.rdb
</code></pre></li>
<li><p>Generate C++ header files (hpp and hdl) for <strong>new</strong> types and their dependencies from rdb files. </p>
<pre><code>$ mkdir -p /home/$username/extensions/inc/SimpleComponent
$ $LOROOT/instdir/sdk/bin/cppumaker -Gc -O/home/$username/extensions/inc/SimpleComponent  \
                                    -Tinco.niocs.test.XSomething -Tinco.niocs.test.MyService1 -Tinco.niocs.test.MyService2 \
                                    /home/$username/extensions/misc/SimpleComponent/SimpleComponent.uno.rdb \
                                    -X$LOROOT/instdir/program/types.rdb -X$LOROOT/instdir/program/types/offapi.rdb
</code></pre><p>In our case it will produce the following four files in <code>/home/$username/extensions/inc/SimpleComponent/inco/niocs/test/</code></p>
<pre><code>MyService1.hpp
XSomething.hpp
XSomething.hdl
MyService2.hpp
</code></pre></li>
<li><p>Compile <code>service1_impl.cxx</code> and <code>service2_impl.cxx</code> using the generated header files and sdk include files to create object files (*.o) and place them in <code>/home/$username/extensions/slo/SimpleComponent</code>.</p>
<pre><code>$ mkdir -p /home/$username/extensions/slo/SimpleComponent
$ gcc -c -fpic -fvisibility=hidden -O -I. -I/home/$username/extensions/inc \
      -I/home/$username/extensions/inc/examples -I$LOROOT/instdir/sdk/include \
      -I/home/$username/extensions/inc/SimpleComponent \
      -DUNX -DGCC -DLINUX -DCPPU_ENV=gcc3 \
      -o/home/$username/extensions/slo/SimpleComponent/service1_impl.o service1_impl.cxx

$ gcc -c -fpic -fvisibility=hidden -O -I. -I/home/$username/extensions/inc \
      -I/home/$username/extensions/inc/examples -I$LOROOT/instdir/sdk/include \
      -I/home/$username/extensions/inc/SimpleComponent \
      -DUNX -DGCC -DLINUX -DCPPU_ENV=gcc3 \
      -o/home/$username/extensions/slo/SimpleComponent/service2_impl.o service2_impl.cxx
</code></pre></li>
<li><p>Create shared library (.so file) from the object files created in step 5 by linking with the sdk libs - cppu, cppuhelper and sal and place it in <code>/home/$username/extensions/lib/</code></p>
<pre><code>$ mkdir -p /home/$username/extensions/lib
$ g++ -shared -Wl,-z,origin &apos;-Wl,-rpath,&apos; -L/home/$username/extensions/lib \
      -L$LOROOT/instdir/sdk/lib -L$LOROOT/instdir/program \
      -o /home/$username/extensions/lib/SimpleComponent.uno.so \
      /home/$username/extensions/slo/SimpleComponent/service1_impl.o \
      /home/$username/extensions/slo/SimpleComponent/service2_impl.o \
      -luno_cppuhelpergcc3 -luno_cppu -luno_sal
</code></pre><p>We have finished creating the main part of the extension, now we need to package into a zip file along with meta files and the rdb file.</p>
</li>
<li><p>Remember that we already have <code>SimpleComponent.uno.rdb</code> in the path <code>/home/$username/extensions/misc/SimpleComponent</code>. Now create the <code>META-INF/manifest.xml</code> and <code>SimpleComponent.components</code> in <code>/home/$username/extensions/misc/SimpleComponent/</code> with the following contents :</p>
<p><strong>manifest.xml</strong> : This xml file tells LO extension manager where to find the rdb file and a file <code>SimpleComponent.components</code> which would point to the .so shared lib.</p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE manifest:manifest PUBLIC &quot;-//OpenOffice.org//DTD Manifest 1.0//EN&quot; &quot;Manifest.dtd&quot;&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">manifest:manifest</span> <span class="hljs-attribute">xmlns:manifest</span>=<span class="hljs-value">&quot;http://openoffice.org/2001/manifest&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">manifest:file-entry</span> <span class="hljs-attribute">manifest:media-type</span>=<span class="hljs-value">&quot;application/vnd.sun.star.uno-typelibrary;type=RDB&quot;</span>
                    <span class="hljs-attribute">manifest:full-path</span>=<span class="hljs-value">&quot;SimpleComponent.uno.rdb&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">manifest:file-entry</span> <span class="hljs-attribute">manifest:media-type</span>=<span class="hljs-value">&quot;application/vnd.sun.star.uno-components;platform=Linux_x86_64&quot;</span>
                    <span class="hljs-attribute">manifest:full-path</span>=<span class="hljs-value">&quot;SimpleComponent.components&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">manifest:manifest</span>&gt;</span>
</code></pre>
<p><strong>SimpleComponent.components</strong> : This is an xml file which tells the LO extension manager where to find the shared library and what all services are implemented along with the fully qualified implementation names.</p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">components</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">&quot;http://openoffice.org/2010/uno-components&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">component</span> <span class="hljs-attribute">loader</span>=<span class="hljs-value">&quot;com.sun.star.loader.SharedLibrary&quot;</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">&quot;Linux_x86_64/SimpleComponent.uno.so&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">implementation</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;inco.niocs.test.my_sc_impl.MyService1&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">service</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;inco.niocs.test.MyService1&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">implementation</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">implementation</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;inco.niocs.test.my_sc_impl.MyService2&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">service</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;inco.niocs.test.MyService2&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">implementation</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">component</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">components</span>&gt;</span>
</code></pre>
<p>Copy the shared lib to <code>/home/$username/extensions/misc/SimpleComponent/Linux_x86_64</code>. We don&apos;t need the some.urd file anymore.
Next we zip the contents in <code>/home/$username/extensions/misc/SimpleComponent</code> to a zip file named <code>SimpleComponent.oxt</code> in <code>/home/$username/extensions/bin/</code></p>
<pre><code>$ mkdir -p /home/$username/extensions/misc/SimpleComponent/Linux_x86_64
$ cp /home/$username/extensions/lib/SimpleComponent.uno.so /home/$username/extensions/misc/SimpleComponent/Linux_x86_64
$ rm /home/$username/extensions/misc/SimpleComponent/some.urd
$ cd /home/$username/extensions/misc/SimpleComponent/
$ mkdir -p /home/$username/extensions/bin/
$ zip -r ../../bin/SimpleComponent.oxt *
</code></pre><p>The file <code>SimpleComponent.oxt</code> is the extension and can be installed to LO using <code>unopkg</code> command or LO extension manager.</p>
</li>
</ol>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../extensions/part3.html" class="navigation navigation-prev " aria-label="Previous page: Part3 UNO communication"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../extensions/part5.html" class="navigation navigation-next " aria-label="Next page: Part5 Addon"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
