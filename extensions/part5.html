<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Part5 Addon | Libreoffice Blog</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="../extensions/part6.html" />
    
    
    <link rel="prev" href="../extensions/part4.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
    

        
    <div class="book" data-level="4.6" data-basepath=".." data-revision="Thu Nov 03 2016 21:15:50 GMT+0530 (IST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="patches/index.html">
            
                
                    <a href="../patches/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        patches
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="patches/rsu.html">
            
                
                    <a href="../patches/rsu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Red squiggly underline bug
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="calcarch/index.html">
            
                
                    <a href="../calcarch/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Calc architecture
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="calcarch/overview.html">
            
                
                    <a href="../calcarch/overview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        overview
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="calcarch/core.html">
            
                
                    <a href="../calcarch/core.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        core
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="calcarch/ui.html">
            
                
                    <a href="../calcarch/ui.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        ui
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="calcarch/filter.html">
            
                
                    <a href="../calcarch/filter.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        filter
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="misc/index.html">
            
                
                    <a href="../misc/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Libreoffice misc
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="misc/devsetup.html">
            
                
                    <a href="../misc/devsetup.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        devsetup
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="misc/sdksetup.html">
            
                
                    <a href="../misc/sdksetup.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        sdksetup
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="misc/devserver.html">
            
                
                    <a href="../misc/devserver.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        devserver
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="misc/bibisect.html">
            
                
                    <a href="../misc/bibisect.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        bibisect
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="misc/mdds.html">
            
                
                    <a href="../misc/mdds.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        mdds
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="misc/namespaces.html">
            
                
                    <a href="../misc/namespaces.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        namespaces
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="misc/patchchecklist.html">
            
                
                    <a href="../misc/patchchecklist.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        patchchecklist
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="extensions/index.html">
            
                
                    <a href="../extensions/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        LibreOffice extensions
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="extensions/prefaq.html">
            
                
                    <a href="../extensions/prefaq.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        PreFAQ
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="extensions/part1.html">
            
                
                    <a href="../extensions/part1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Part1 UNO Intro
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="extensions/part2.html">
            
                
                    <a href="../extensions/part2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        Part2 Remote Calc
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="extensions/part3.html">
            
                
                    <a href="../extensions/part3.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        Part3 UNO communication
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="extensions/part4.html">
            
                
                    <a href="../extensions/part4.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        Part4 Simple component
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="4.6" data-path="extensions/part5.html">
            
                
                    <a href="../extensions/part5.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        Part5 Addon
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="extensions/part6.html">
            
                
                    <a href="../extensions/part6.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        Part6 ProtocolHandler extension
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="extensions/part7.html">
            
                
                    <a href="../extensions/part7.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.</b>
                        
                        Part7 AsyncJob extension
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="extensions/part8.html">
            
                
                    <a href="../extensions/part8.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.</b>
                        
                        Part8 SingletonComponent
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Libreoffice Blog</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="libreoffice-extension-development-with-c-part-5-build-a-simple-addon-with-a-menu-and-toolbar-buttons">Libreoffice extension development with C++ - Part 5 - Build a simple addon with a menu and toolbar buttons.</h1>
<h3 id="audience-selection">Audience selection</h3>
<ol>
<li>Audience type <strong><a href="index.html">AUD-C</a></strong> can jump directly to <strong><a href="#prebuilt">Test the prebuilt extension</a></strong></li>
<li>Audience type <strong><a href="index.html">AUD-B</a></strong> can jump directly to <strong><a href="#buildsec">Download, build and test the extension</a></strong></li>
</ol>
<hr>
<p>An <strong>addon</strong> is a type of extension which adds UI elements to LO and allows user interaction.
LO uses <em>&quot;Command URLs&quot;</em> for communication between UI layer and the application objects.</p>
<blockquote>
<p>When a user chooses an item in the user interface, a command URL is dispatched to the application framework and processed in a chain of responsibility until an object accepts the command and executes it, thus consuming the command URL. This mechanism is known as the <em>dispatch framework</em></p>
</blockquote>
<p>The user interface of LO can be changed by an addon extension by providing an xml file with <em>.xcu</em> extension in the <em>oxt</em> file. We can add new menus and toolbar items and configure them to send command URLS. It is also possible to disable existing commands. We will see in part6 and part7 that we can make components that can handle/consume commandURLs from the UI and run actions for them.</p>
<p>The command URL is of the form</p>
<pre><code>&lt;Protocol&gt;:&lt;Path&gt;
</code></pre><p>Example :</p>
<pre><code>inco.niocs.test.extension:InsertDate
</code></pre><p>In this case the protocol part is <code>inco.niocs.test.extension</code> and the path is <code>InsertDate</code>. When creating new command URLs, we should use a protocol part that is likely to be unique. For example using a scheme like <code>com.&lt;companyname&gt;.&lt;company-namespace&gt;.&lt;extension-namespace&gt;</code> for protocol part would ensure uniqueness across all command URLs in LO.</p>
<p>In this part, we add a new menu called <code>Add-On example</code> with menu entry called <code>Make text Bold</code>. On user click it would send the LO built-in command URL <code>.uno:Bold</code>. Here the protocol part is <code>.uno</code> and the path is <code>Bold</code>. On issuing this command to the dispatch framework of LO, it would toggle the selected text&apos;s bold attribute.</p>
<p>To add this menu we do not need any C++ component as LO already has the functionality to handle the command <code>.uno:Bold</code>. We only need to create an xml file as follows :</p>
<p><strong>Addons.xcu</strong></p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">oor:component-data</span> <span class="hljs-attribute">xmlns:oor</span>=<span class="hljs-value">&quot;http://openoffice.org/2001/registry&quot;</span> <span class="hljs-attribute">xmlns:xs</span>=<span class="hljs-value">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Addons&quot;</span> <span class="hljs-attribute">oor:package</span>=<span class="hljs-value">&quot;org.openoffice.Office&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;AddonUI&quot;</span>&gt;</span>
        <span class="hljs-comment">&lt;!--  We add our custom menus here --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">oor:component-data</span>&gt;</span>
</code></pre>
<p>The above xml is the same for all addons, so no need to change any values in it.</p>
<p>Now we add xml content inside the above code to create a custom menu <code>Add-On example</code> inside the LO&apos;s menu bar.</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;OfficeMenuBar&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;inco.niocs.test.addon.example&quot;</span> <span class="hljs-attribute">oor:op</span>=<span class="hljs-value">&quot;replace&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Title&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xml:lang</span>=<span class="hljs-value">&quot;en-US&quot;</span>&gt;</span>Add-On example<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Target&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>_self<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
    <span class="hljs-comment">&lt;!--   INSERT SUBMENU&apos;s here  --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>
</code></pre>
<p>The top level node of the above xml segment has <code>name</code> attribute set as <code>OfficeMenuBar</code>. This indicates that the menu we are going to add is a top-level menu in LO menu bar.
The child node should have an unique value for <code>name</code> attribute for the newly inserted menu and should have <code>op</code> set as <code>replace</code>. The replace operation must be used to add a new node to a set or extensible node. Thus the real meaning of the operation is &quot;add or replace&quot;.</p>
<p>Teh child elements of our menu node should have <code>prop</code> nodes with further <code>value</code> child nodes for the properties <code>Title</code> and <code>Target</code>.
We set property <code>Title</code> to the value <code>Add-On example</code> which is the display title of the new menu. The <code>Target</code> property can have one of <code>_top</code>, <code>_parent</code>, <code>_self</code>, <code>_blank</code> indicating which frame of LO should accept the command URL emitted from the menu. We choose <code>_self</code> so that the current frame get the command.</p>
<p>Now we need to add xml code for inserting the menu item titled <code>Make text Bold</code> that produces the command <code>.uno:Bold</code>.</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Submenu&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;m1&quot;</span> <span class="hljs-attribute">oor:op</span>=<span class="hljs-value">&quot;replace&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;URL&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>.uno:Bold<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Title&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xml:lang</span>=<span class="hljs-value">&quot;en-US&quot;</span>&gt;</span>Make text Bold<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Target&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>_self<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Context&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>com.sun.star.sheet.SpreadsheetDocument<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;m2&quot;</span> <span class="hljs-attribute">oor:op</span>=<span class="hljs-value">&quot;replace&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;URL&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>.uno:Italic<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Title&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xml:lang</span>=<span class="hljs-value">&quot;en-US&quot;</span>&gt;</span>Make text Italic<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Target&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>_self<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Context&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>com.sun.star.sheet.SpreadsheetDocument<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>
</code></pre>
<p>We add as a child to our Top level menu a node named <code>Submenu</code> indicating that we are going to add a set of sub-menus.
The first menu entry we add is indicated by creating a child node under the <code>Submenu</code> node. This node should have a unique name say <code>m1</code> under the top level menu we added.
The <code>m1</code> node will then have the following property values :</p>
<ol>
<li><p>URL : indicate the command URL the menu entry creates which is <code>.uno:Bold</code>.</p>
</li>
<li><p>Title : The display name of the menu entry.</p>
</li>
<li><p>Target : Set the value as <code>_self</code> as the action need to take place in the current frame.</p>
</li>
<li><p>Context : This indicate the type of document for which menu entry should be shown. We set it to <code>com.sun.star.sheet.SpreadsheetDocument</code> to indicate that the menu entry should only be shown for spreadsheet docs. The possible values for <code>Context</code> are : </p>
<ol>
<li>Writer: com.sun.star.text.TextDocument</li>
<li>Spreadsheet: com.sun.star.sheet.SpreadsheetDocument</li>
<li>Presentation: com.sun.star.presentation.PresentationDocument</li>
<li>Draw: com.sun.star.drawing.DrawingDocument</li>
<li>Formula: com.sun.star.formula.FormulaProperties</li>
<li>Chart: com.sun.star.chart2.ChartDocument</li>
<li>Bibliography: com.sun.star.frame.Bibliography</li>
</ol>
</li>
</ol>
<p>Similarly we create another menu entry for <code>Make text italic</code> using a node named <code>m2</code> with command URL <code>.uno:Italic</code>.</p>
<p>Now we add two new toolbar entries with our own command URL&apos;s <code>inco.niocs.test.addon.example:InsertDate</code> and <code>inco.niocs.test.addon.example:InsertTime</code>. In this project we only define these toolbar entries and not the command URL&apos;s executor/consumer which we will see in upcoming part6.</p>
<pre><code class="lang-xml"><span class="hljs-comment">&lt;!-- INSIDE AddonUI node --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;OfficeToolBar&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;inco.niocs.test.addon.example&quot;</span> <span class="hljs-attribute">oor:op</span>=<span class="hljs-value">&quot;replace&quot;</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- The InsertDate tool bar item --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;m1&quot;</span> <span class="hljs-attribute">oor:op</span>=<span class="hljs-value">&quot;replace&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;URL&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>inco.niocs.test.addon.example:InsertDate<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Title&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xml:lang</span>=<span class="hljs-value">&quot;en-US&quot;</span>&gt;</span>Insert Date<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Target&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>_self<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Context&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>com.sun.star.sheet.SpreadsheetDocument<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- The InsertTime tool bar item --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;m1&quot;</span> <span class="hljs-attribute">oor:op</span>=<span class="hljs-value">&quot;replace&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;URL&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>inco.niocs.test.addon.example:InsertTime<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Title&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xml:lang</span>=<span class="hljs-value">&quot;en-US&quot;</span>&gt;</span>Insert Time<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Target&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>_self<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Context&quot;</span> <span class="hljs-attribute">oor:type</span>=<span class="hljs-value">&quot;xs:string&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>com.sun.star.sheet.SpreadsheetDocument<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>
<span class="hljs-comment">&lt;!-- INSIDE AddonUI node --&gt;</span>
</code></pre>
<p>For creating toolbar entries, we need to add a <code>OfficeToolBar</code> node inside the <code>AddonUI</code> node. Inside that we create a node indicating creation of a new toolbar named uniquely. Here we name it <code>inco.niocs.test.addon.example</code>. Under this node, we create two nodes <code>m1</code> and <code>m2</code> (unique names under <strong>our</strong> toolbar namespace). Each node has the following property values :</p>
<ol>
<li><p><em>URL</em> : The command URL to produce on user click on the toolbar item.</p>
</li>
<li><p><em>Title</em> : The display title for the item.</p>
</li>
<li><p><em>Target</em> : The frame to which the command URL needs to send.</p>
</li>
<li><p><em>Context</em> : We set it to <code>com.sun.star.sheet.SpreadsheetDocument</code> to indicate that the menu entry should only be shown for spreadsheet docs.</p>
</li>
</ol>
<p>Next we set images/icons for the toolbar/menu items we created.</p>
<pre><code class="lang-xml"><span class="hljs-comment">&lt;!-- INSIDE AddonUI node --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;Images&quot;</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Images for InsertDate --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;inco.niocs.test.addon.example.date&quot;</span> <span class="hljs-attribute">oor:op</span>=<span class="hljs-value">&quot;replace&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;URL&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>inco.niocs.test.addon.example:InsertDate<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;UserDefinedImages&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;ImageSmallURL&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>%origin%/images/date.png<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>    
        <span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Images for InsertTime --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;inco.niocs.test.addon.example.time&quot;</span> <span class="hljs-attribute">oor:op</span>=<span class="hljs-value">&quot;replace&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;URL&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>inco.niocs.test.addon.example:InsertTime<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">node</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;UserDefinedImages&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">prop</span> <span class="hljs-attribute">oor:name</span>=<span class="hljs-value">&quot;ImageSmallURL&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>%origin%/images/time.png<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">prop</span>&gt;</span>    
        <span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">node</span>&gt;</span>
<span class="hljs-comment">&lt;!-- INSIDE AddonUI node --&gt;</span>
</code></pre>
<p>For adding icons for the command URL&apos;s we added, we need to add a node named <code>Images</code> inside <code>AddonUI</code> node. Inside it we add two nodes <code>inco.niocs.test.addon.example.date</code> and <code>inco.niocs.test.addon.example.time</code> (unique names) for the InsertDate and InsertTime commands respectively. The sole property value of these two nodes is <code>URL</code> and we set them to the corresponding command URLs. We now need to add a node named <code>UserDefinedImages</code> which contains the info on the set of images for that command URL. This node can have the following property values :</p>
<ol>
<li><p><em>ImageSmall</em> : The value should be hexbinary of the image of size 16x16 px.</p>
</li>
<li><p><em>ImageBig</em> : The value should be hexbinary of the image of size 26x26 px.</p>
</li>
<li><p><em>ImageSmallHC</em> : The value should be hexbinary of the image of size 16x16 px used for high contrast environments.</p>
</li>
<li><p><em>ImageBigHC</em> : The value should be hexbinary of the image of size 26x26 px used for high contrast environments.</p>
</li>
<li><p><em>ImageSmallURL</em> : The value should be a url to the external <em>small</em> image that resides in the oxt file. The special string <code>%origin%</code> can be used to resolve to the location where our extension is placed after installing it with <code>unopkg</code> or the extension manager. Example <code>%origin%/images/small/date.png</code>.</p>
</li>
<li><p><em>ImageBigURL</em> : Same as 5 but for big size image.</p>
</li>
<li><p><em>ImageSmallHCURL</em> : Same as 5 but for high contrast image.</p>
</li>
<li><p><em>ImageBigHCURL</em> : Same as 6 but for high contrast image.</p>
</li>
</ol>
<p>The <code>xcu</code> file we created needs to be added to the manifest.xml of the extension file. This is done via Makefile in the <code>SimpleAddonExtension</code> github project.</p>
<hr>
<h2 id="-a-name-buildsec-a-download-build-and-test-the-extension"><a name="buildsec"></a>Download, build and test the extension</h2>
<p>The whole project can be downloaded and built using the following steps.</p>
<pre><code>$ git clone https://github.com/niocs/SimpleAddonExtension.git
$ cd SimpleAddonExtension
$ make
</code></pre><p>This will create the extension file <code>SimpleAddonExtension.oxt</code> inside <code>/home/$username/libreoffice5.3_sdk/LINUXexample.out/bin</code>.
Use unopkg to install this extension to LO as :</p>
<pre><code>$ $LOROOT/instdir/program/unopkg add /path/to/SimpleAddonExtension.oxt
</code></pre><p>To remove the extension use :</p>
<pre><code>$ $LOROOT/instdir/program/unopkg remove SimpleAddonExtension.oxt
</code></pre><p>On opening calc you should see the top level menu called <code>Add-On example</code> with menu entries <code>Make text Bold</code> and <code>Make text Italic</code>. Add some text to any cell and try clicking on the new menu items and see if the text gets bold/italicized. The two new toolbar icons also should be visible. Clicking them would not produce any results though but can notice that calc will log errors like</p>
<pre><code>warn:ucb.ucp.gio:7313:1:ucb/source/ucp/gio/gio_content.cxx:399: ignoring GError &quot;The specified location is not supported&quot; for &lt;inco.niocs.test.addon.example:InsertDate&gt;
warn:unotools.misc:7313:1:unotools/source/misc/mediadescriptor.cxx:689: caught Exception &quot;Unable to retrieve value of property &apos;IsDocument&apos;!&quot; while opening &lt;inco.niocs.test.addon.example:InsertDate&gt;
warn:filter.config:7313:1:filter/source/config/cache/typedetection.cxx:455: caught Exception &quot;Could not open stream for &lt;inco.niocs.test.addon.example:InsertDate&gt;&quot; while querying type of &lt;inco.niocs.test.addon.example:InsertDate&gt;
warn:fwk.dispatch:7313:1:framework/source/dispatch/loaddispatcher.cxx:132: caught LoadEnvException 0 &quot;type detection failed&quot; while dispatching &lt;inco.niocs.test.addon.example:InsertDate&gt;
warn:ucb.ucp.gio:7313:1:ucb/source/ucp/gio/gio_content.cxx:399: ignoring GError &quot;The specified location is not supported&quot; for &lt;inco.niocs.test.addon.example:InsertTime&gt;
warn:unotools.misc:7313:1:unotools/source/misc/mediadescriptor.cxx:689: caught Exception &quot;Unable to retrieve value of property &apos;IsDocument&apos;!&quot; while opening &lt;inco.niocs.test.addon.example:InsertTime&gt;
warn:filter.config:7313:1:filter/source/config/cache/typedetection.cxx:455: caught Exception &quot;Could not open stream for &lt;inco.niocs.test.addon.example:InsertTime&gt;&quot; while querying type of &lt;inco.niocs.test.addon.example:InsertTime&gt;
warn:fwk.dispatch:7313:1:framework/source/dispatch/loaddispatcher.cxx:132: caught LoadEnvException 0 &quot;type detection failed&quot; while dispatching &lt;inco.niocs.test.addon.example:InsertTime&gt;
</code></pre><p>You should also notice that the new menu/toolbars don&apos;t appear in Writer or Impress.</p>
<hr>
<h2 id="-a-name-prebuilt-a-test-the-prebuilt-extension"><a name="prebuilt"></a>Test the prebuilt extension</h2>
<p>Download the extension as :</p>
<pre><code>$ git clone https://github.com/niocs/SimpleAddonExtension.git
$ cd SimpleAddonExtension
</code></pre><p>In <code>SimpleAddonExtension</code> directory you will see a file called <code>SimpleAddonExtension.oxt</code>. This is the prebuilt extension. Install this extension using</p>
<pre><code>$ unopkg add /path/to/SimpleAddonExtension.oxt
</code></pre><p>To remove this extension do :</p>
<pre><code>$ unopkg remove SimpleAddonExtension.oxt
</code></pre><p>On opening calc you should see the top level menu called <code>Add-On example</code> with menu entries <code>Make text Bold</code> and <code>Make text Italic</code>. Add some text to any cell and try clicking on the new menu items and see if the text gets bold/italicized. The two new toolbar icons <img src="date.png" alt="date icon"> and <img src="time.png" alt="time icon"> also should be visible. Clicking them would not produce any results though. You should also notice that the new menu does not appear in Writer or Impress or Draw.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../extensions/part4.html" class="navigation navigation-prev " aria-label="Previous page: Part4 Simple component"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../extensions/part6.html" class="navigation navigation-next " aria-label="Next page: Part6 ProtocolHandler extension"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
